define(["common/lodash","common/moment","leave-absences/absence-tab/modules/components","leave-absences/absence-tab/components/absence-tab-custom-work-pattern-modal"],function(n,t,e){function o(e,o,a,r,c,i,s,l,u,d){function f(){return d.workPatternsOf(h.contactId,{},!1).then(function(n){h.customWorkPatterns=n})}function m(){return d.default().then(function(n){h.defaultWorkPattern=n})}function p(){return u.valuesOf("hrjc_revision_change_reason").then(function(t){g=n.indexBy(t,"value")})}function b(n){var t=[f()];return n&&(t=t.concat(n)),h.loading.workPattern=!0,o.all(t).then(function(){k()}).finally(function(){h.loading.workPattern=!1})}function k(){var e,o=l.DATE_FORMAT.toUpperCase();h.customWorkPatterns=n(h.customWorkPatterns).map(function(n){return e=g[n.change_reason],n.change_reason_label=e?e.label:"",n.effective_date=n.effective_date?t(n.effective_date).format(o):"",n}).sortBy(function(n){return-t(n.effective_date,o).valueOf()}).value()}function v(){var n="civicrm/admin/leaveandabsences/work_patterns",t="civicrm/contact/view",e=CRM.url(t,{cid:h.contactId,selectedChild:"absence"});return CRM.url(n,{cid:h.contactId,returnUrl:e})}e.debug("Component: absence-tab-work-patterns");var g=[],h=Object.create(this);return h.customWorkPatterns=[],h.defaultWorkPattern=null,h.linkToWorkPatternListingPage=v(),h.loading={workPattern:!0},function(){b([p(),m(),s.getDateFormat()]),r.$on("CustomWorkPattern::Added",function(){b()})}(),h.deleteWorkPattern=function(n){i.open({title:"Confirm Deletion?",copyCancel:"Cancel",copyConfirm:"Confirm",classConfirm:"btn-danger",msg:"This cannot be undone",onConfirm:function(){d.unassignWorkPattern(n).then(function(){b()})}})},h.openModal=function(){c.open({appendTo:a.children().eq(0),template:'<absence-tab-custom-work-pattern-modal dismiss="$ctrl.dismiss()" contact-id="'+h.contactId+'"/>',controller:["$uibModalInstance",function(n){this.dismiss=n.dismiss}],controllerAs:"$ctrl"})},h}e.component("absenceTabWorkPatterns",{bindings:{contactId:"<"},templateUrl:["settings",function(n){return n.pathTpl+"components/absence-tab-work-patterns.html"}],controllerAs:"workpatterns",controller:["$log","$q","$rootElement","$rootScope","$uibModal","dialog","DateFormat","HR_settings","OptionGroup","WorkPattern",o]})});