define(["leave-absences/shared/modules/apis","common/lodash","common/services/api"],function(e,t){"use strict";e.factory("LeaveRequestAPI",["$log","api","$q","shared-settings",function(e,a,n){return e.debug("LeaveRequestAPI"),a.extend({all:function(t,a,s,r,u){e.debug("LeaveRequestAPI.all");var d=n.defer();return t&&t.contact_id&&t.contact_id.IN&&0===t.contact_id.IN.length?d.resolve({list:[],total:0,allIds:[]}):d.resolve(this.getAll("LeaveRequest",t,a,s,r,"getFull",u)),d.promise},balanceChangeByAbsenceType:function(t,a,s,r){e.debug("LeaveRequestAPI.balanceChangeByAbsenceType");var u=n.defer();t&&a||u.reject("contact_id and period_id are mandatory");var d={contact_id:t,period_id:a,statuses:s?{IN:s}:null,public_holiday:r||!1};return this.sendGET("LeaveRequest","getbalancechangebyabsencetype",d,!1).then(function(e){u.resolve(e.values)}),u.promise},calculateBalanceChange:function(t){e.debug("LeaveRequestAPI.calculateBalanceChange",t);var a=n.defer();return!t||t.contact_id&&t.from_date&&t.from_date_type||a.reject("contact_id, from_date and from_date_type in params are mandatory"),this.sendPOST("LeaveRequest","calculatebalancechange",t).then(function(e){a.resolve(e.values)}),a.promise},create:function(t){e.debug("LeaveRequestAPI.create",t);var a=n.defer();return t&&(t.to_date&&!t.to_date_type?a.reject("to_date_type is mandatory"):t.contact_id&&t.from_date&&t.from_date_type&&t.status_id||a.reject("contact_id, from_date, status_id and from_date_type params are mandatory")),this.sendPOST("LeaveRequest","create",t).then(function(e){a.resolve(e.values[0])}),a.promise},delete:function(e){return this.sendPOST("LeaveRequest","delete",{id:e})},deleteAttachment:function(e,a,n){return n=t.assign({},n,{leave_request_id:e,attachment_id:a}),this.sendPOST("LeaveRequest","deleteattachment",n).then(function(e){return e.values})},deleteComment:function(e,a){return a=t.assign({},a,{comment_id:e}),this.sendPOST("LeaveRequest","deletecomment",a).then(function(e){return e.values})},getAttachments:function(e,a){return a=t.assign({},a,{leave_request_id:e}),this.sendGET("LeaveRequest","getattachments",a,!1).then(function(e){return e.values})},getComments:function(e,a){return a=t.assign({},a,{leave_request_id:e}),this.sendGET("LeaveRequest","getcomment",a,!1).then(function(e){return e.values})},isValid:function(a){e.debug("LeaveRequestAPI.isValid",a);var s=n.defer();return this.sendPOST("LeaveRequest","isValid",a).then(function(e){e.count>0?s.reject(t(e.values).map().flatten().value()):s.resolve(e.values)}),s.promise},saveComment:function(e,a,n){return n=t.assign({},n,{leave_request_id:e,text:a.text,contact_id:a.contact_id,created_at:a.created_at}),this.sendPOST("LeaveRequest","addcomment",n).then(function(e){return e.values})},update:function(t){e.debug("LeaveRequestAPI.update",t);var a=n.defer();return t.id||a.reject("id is mandatory field"),this.sendPOST("LeaveRequest","create",t).then(function(e){a.resolve(e.values[0])}),a.promise}})}])});