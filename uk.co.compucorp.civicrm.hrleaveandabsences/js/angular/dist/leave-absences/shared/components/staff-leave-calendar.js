define(["common/lodash","common/moment","leave-absences/shared/modules/components","leave-absences/shared/controllers/calendar-ctrl"],function(e,t,n){function a(n,a,o,s){function r(t,n){c.leaveRequests=e.omit(c.leaveRequests,function(e){return e.id===n.id}),c._resetMonths(),c._setCalendarProps(d)}a.debug("Component: staff-leave-calendar");var d,l=n("CalendarCtrl"),c=Object.create(l);return c.getMonthData=function(t){var n;return n=e.find(c.months,function(e){return e.month===t.month&&e.year===t.year}),n?n.data:[]},c.refresh=function(){c.loading.calendar=!0,c._resetMonths(),c._loadLeaveRequestsAndCalendar()},c._getMonthSkeleton=function(e){return{month:e.month(),year:e.year(),data:[]}},c._indexLeaveRequests=function(t){c.leaveRequests={},e.each(t,function(t){e.each(t.dates,function(e){c.leaveRequests[e.date]=t})})},c._loadCalendar=function(){return s.get(c.contactId,c.selectedPeriod.id).then(function(e){d=e,c._setCalendarProps(d)})},c._loadLeaveRequestsAndCalendar=function(){return l._loadLeaveRequestsAndCalendar.call(c,"contact_id",!1)},c._setCalendarProps=function(n){var a,o=e.clone(c.months);e.each(n.days,function(e){a=c.leaveRequests[e.date],e.UI={isWeekend:n.isWeekend(c._getDateObjectWithFormat(e.date)),isNonWorkingDay:n.isNonWorkingDay(c._getDateObjectWithFormat(e.date)),isPublicHoliday:c.isPublicHoliday(e.date)},a&&(e.UI.styles=c._getStyles(a,e),e.UI.isRequested=c._isPendingApproval(a),e.UI.isAM=c._isDayType("half_day_am",a,e.date),e.UI.isPM=c._isDayType("half_day_pm",a,e.date)),c._getMonthObjectByDate(t(e.date),o).data.push(e)}),c.months=o},function(){c._init(),o.$on("LeaveRequest::new",c.refresh),o.$on("LeaveRequest::edit",c.refresh),o.$on("LeaveRequest::deleted",r)}(),c}n.component("staffLeaveCalendar",{bindings:{contactId:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"components/staff-leave-calendar.html"}],controllerAs:"calendar",controller:["$controller","$log","$rootScope","Calendar",a]})});