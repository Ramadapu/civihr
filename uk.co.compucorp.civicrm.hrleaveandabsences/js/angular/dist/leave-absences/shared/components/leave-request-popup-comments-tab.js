define(["common/lodash","common/moment","leave-absences/shared/modules/components","common/services/hr-settings"],function(e,t,n){function o(n,o,c,m){function r(){var t=[];return e.each(s.request.comments,function(e){e.contact_id!==s.request.contact_id&&t.indexOf(e.contact_id)===-1&&t.push(e.contact_id)}),m.all({id:{IN:t}},{page:1,size:0}).then(function(t){s.comment.contacts=e.indexBy(t.list,"contact_id")})}function a(){return s.request.loadComments().then(function(){s.request.comments.length&&r()})}n.debug("Component: leave-request-popup-comments-tab");var s=Object.create(this);return s.comment={text:"",contacts:{}},function(){a()}(),s.addComment=function(){s.request.comments.push({contact_id:s.request.contact_id,created_at:t(new Date).format(c.serverDateTimeFormat),leave_request_id:s.request.id,text:s.comment.text}),s.comment.text=""},s.formatDateTime=function(e){return t(e,c.serverDateTimeFormat).format(o.DATE_FORMAT.toUpperCase()+" HH:mm")},s.getActiveComments=function(){return s.request.comments.filter(function(e){return!e.toBeDeleted})},s.getCommentorName=function(e){return e===s.request.contact_id?"Me":s.comment.contacts[e]?s.comment.contacts[e].display_name:void 0},s.isMode=function(e){return s.mode===e},s.orderComment=function(e){return t(e.created_at,c.serverDateTimeFormat)},s.removeCommentVisibility=function(e){return!e.comment_id||s.canManage},s}n.component("leaveRequestPopupCommentsTab",{bindings:{canManage:"<",mode:"<",request:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"directives/leave-request-popup/leave-request-popup-comments-tab.html"}],controllerAs:"commentsCtrl",controller:["$log","HR_settings","shared-settings","Contact",o]})});