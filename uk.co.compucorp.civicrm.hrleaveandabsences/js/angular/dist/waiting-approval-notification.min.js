!function(e){define("leave-absences/shared/config",[],function(){var n=CRM.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences/shared";e.config({paths:{"leave-absences/shared/ui-router":"leave-absences/shared/vendor/angular-ui-router.min"},shim:{"leave-absences/shared/ui-router":{}}}),e.config({paths:{"leave-absences/shared/ui-router":n+"/vendor/angular-ui-router.min"}})})}(require),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(n){return n.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/components",["common/angular"],function(e){return e.module("leave-absences.components",[])}),define("leave-absences/shared/components/leave-notification.component",["leave-absences/shared/modules/components"],function(e){function n(e,n,t,a){function s(){return a.all(c).then(function(e){r.count=e.list.length})}function i(e,n){return c=n,s()}function o(){n.$on("WaitingApproval:: Initialize Filters",i),t.subscribe("LeaveRequest::"+r.eventName,s)}e.debug("Component: leave-notification");var c={},r=this;return r.count=0,function(){o()}(),r}e.component("leaveNotification",{bindings:{eventName:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"components/leave-notification.html"}],controllerAs:"notification",controller:["$log","$rootScope","pubSub","LeaveRequest",n]})}),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models.instances","common.services","leave-absences.settings"])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/models/instances/leave-request-instance",["common/lodash","leave-absences/shared/modules/models-instances","common/models/option-group","common/models/instances/instance"],function(e,n){"use strict";n.factory("LeaveRequestInstance",["$q","OptionGroup","shared-settings","ModelInstance","LeaveRequestAPI",function(n,t,a,s,i){function o(e){return u(e).then(function(e){return this.status_id=e.value,this.update()}.bind(this))}function c(e){return u(e).then(function(e){return this.status_id===e.value}.bind(this))}function r(){var t=[];return e.forEach(this.files,function(e){e.toBeDeleted&&t.push(i.deleteAttachment(this.id,e.attachment_id))}.bind(this)),n.all(t)}function u(e){return t.valuesOf("hrleaveandabsences_leave_request_status").then(function(n){return n.find(function(n){return n.name===e})})}function l(){var e=[],t=this;return t.comments.map(function(n,a){n.comment_id?n.toBeDeleted&&e.push(i.deleteComment(n.comment_id)):!function(a){e.push(i.saveComment(t.id,n).then(function(e){t.comments[a]=e}))}(a)}),n.all(e)}return s.extend({defaultCustomData:function(){return{comments:[],files:[],request_type:"leave"}},cancel:function(){return o.call(this,a.statusNames.cancelled)},approve:function(){return o.call(this,a.statusNames.approved)},reject:function(){return o.call(this,a.statusNames.rejected)},sendBack:function(){return o.call(this,a.statusNames.moreInformationRequired)},update:function(){return i.update(this.toAPI()).then(function(){return n.all([l.call(this),r.call(this)])}.bind(this))},create:function(){return i.create(this.toAPI()).then(function(e){return this.id=e.id,n.all([l.call(this)])}.bind(this))},deleteAttachment:function(e){e.toBeDeleted||(e.toBeDeleted=!0)},deleteComment:function(n){return n.comment_id?void(n.toBeDeleted=!0):void(this.comments=e.reject(this.comments,function(e){return n.created_at===e.created_at&&n.text===e.text}))},delete:function(){return i.delete(this.id)},isValid:function(){return i.isValid(this.toAPI())},isApproved:function(){return c.call(this,a.statusNames.approved)},isAwaitingApproval:function(){return c.call(this,a.statusNames.awaitingApproval)},isCancelled:function(){return c.call(this,a.statusNames.cancelled)},isRejected:function(){return c.call(this,a.statusNames.rejected)},isSentBack:function(){return c.call(this,a.statusNames.moreInformationRequired)},loadComments:function(){return this.id?i.getComments(this.id).then(function(e){this.comments=e}.bind(this)):n.resolve()},toAPIFilter:function(n,t,a){e.includes(["balance_change","dates","comments","files"],a)||(n[a]=this[a])},loadAttachments:function(){return this.id?i.getAttachments(this.id).then(function(e){this.files=e}.bind(this)):n.resolve()}})}])}),define("leave-absences/shared/apis/leave-request-api",["leave-absences/shared/modules/apis","common/lodash","common/services/api"],function(e,n){"use strict";e.factory("LeaveRequestAPI",["$log","api","$q","shared-settings",function(e,t,a){return e.debug("LeaveRequestAPI"),t.extend({all:function(n,t,s,i,o){e.debug("LeaveRequestAPI.all");var c=a.defer();return n&&n.contact_id&&n.contact_id.IN&&0===n.contact_id.IN.length?c.resolve({list:[],total:0,allIds:[]}):c.resolve(this.getAll("LeaveRequest",n,t,s,i,"getFull",o)),c.promise},balanceChangeByAbsenceType:function(n,t,s,i){e.debug("LeaveRequestAPI.balanceChangeByAbsenceType");var o=a.defer();n&&t||o.reject("contact_id and period_id are mandatory");var c={contact_id:n,period_id:t,statuses:s?{IN:s}:null,public_holiday:i||!1};return this.sendGET("LeaveRequest","getbalancechangebyabsencetype",c,!1).then(function(e){o.resolve(e.values)}),o.promise},calculateBalanceChange:function(n){e.debug("LeaveRequestAPI.calculateBalanceChange",n);var t=a.defer();return!n||n.contact_id&&n.from_date&&n.from_date_type||t.reject("contact_id, from_date and from_date_type in params are mandatory"),this.sendPOST("LeaveRequest","calculatebalancechange",n).then(function(e){t.resolve(e.values)}),t.promise},create:function(n){e.debug("LeaveRequestAPI.create",n);var t=a.defer();return n&&(n.to_date&&!n.to_date_type?t.reject("to_date_type is mandatory"):n.contact_id&&n.from_date&&n.from_date_type&&n.status_id||t.reject("contact_id, from_date, status_id and from_date_type params are mandatory")),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise},delete:function(e){return this.sendPOST("LeaveRequest","delete",{id:e})},deleteAttachment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,attachment_id:t}),this.sendPOST("LeaveRequest","deleteattachment",a).then(function(e){return e.values})},deleteComment:function(e,t){return t=n.assign({},t,{comment_id:e}),this.sendPOST("LeaveRequest","deletecomment",t).then(function(e){return e.values})},getAttachments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getattachments",t,!1).then(function(e){return e.values})},getComments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getcomment",t,!1).then(function(e){return e.values})},isValid:function(t){e.debug("LeaveRequestAPI.isValid",t);var s=a.defer();return this.sendPOST("LeaveRequest","isValid",t).then(function(e){e.count>0?s.reject(n(e.values).map().flatten().value()):s.resolve(e.values)}),s.promise},saveComment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,text:t.text,contact_id:t.contact_id,created_at:t.created_at}),this.sendPOST("LeaveRequest","addcomment",a).then(function(e){return e.values})},update:function(n){e.debug("LeaveRequestAPI.update",n);var t=a.defer();return n.id||t.reject("id is mandatory field"),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise}})}])}),define("leave-absences/shared/models/leave-request-model",["leave-absences/shared/modules/models","leave-absences/shared/models/instances/leave-request-instance","leave-absences/shared/apis/leave-request-api","common/models/model"],function(e){"use strict";e.factory("LeaveRequest",["$log","Model","LeaveRequestAPI","LeaveRequestInstance",function(e,n,t,a){return e.debug("LeaveRequest"),n.extend({all:function(e,n,s,i,o){return t.all(this.processFilters(e),n,s,i,o).then(function(e){return e.list=e.list.map(function(e){return a.init(e,!0)}),e})},balanceChangeByAbsenceType:function(e,n,a,s){return t.balanceChangeByAbsenceType(e,n,a,s)},calculateBalanceChange:function(n){return e.debug("LeaveRequestAPI.calculateBalanceChange"),t.calculateBalanceChange(n)}})}])}),define("leave-absences/waiting-approval-notification/modules/components",["common/angular"],function(e){return e.module("waiting-approval-notification.components",[])}),define("leave-absences/waiting-approval-notification/components/waiting-approval-notification.component",["common/lodash","leave-absences/waiting-approval-notification/modules/components"],function(e,n){function t(n,t,a,s,i,o){function c(){return s.get().then(function(e){l.managed_by=e.contact_id})}function r(){return u().then(function(){l.status_id=e.find(d,function(e){return e.name===o.statusNames.awaitingApproval}).value})}function u(){return i.valuesOf("hrleaveandabsences_leave_request_status").then(function(e){d=e})}n.debug("Component: waiting-approval-notification");var l={},d=[],m=this;return m.eventName="updateStatus",function(){t.all([c(),r()]).then(function(){a.$emit("WaitingApproval:: Initialize Filters",l)})}(),m}n.component("waitingApprovalNotification",{templateUrl:["settings",function(e){return e.pathTpl+"components/waiting-approval-notification.html"}],controllerAs:"waitingApprovalNotification",controller:["$log","$q","$rootScope","Session","OptionGroup","shared-settings",t]})}),function(e){define("leave-absences/waiting-approval-notification/modules/settings",["common/angular"],function(n){return n.module("waiting-approval-notification.settings",[]).constant("settings",{debug:e.debug,pathTpl:e.vars.leaveAndAbsences.baseURL+"/views/waiting-approval-notification/"})})}(CRM),function(e){define("leave-absences/waiting-approval-notification/modules/config",["common/angular","leave-absences/waiting-approval-notification/modules/settings"],function(e){return e.module("waiting-approval-notification.config",["waiting-approval-notification.settings"]).config(["$resourceProvider","$httpProvider","$logProvider","settings",function(e,n,t,a){t.debugEnabled(a.debug),e.defaults.stripTrailingSlashes=!1,n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])})}(CRM),define("leave-absences/waiting-approval-notification/app",["common/angular","common/services/pub-sub","common/services/session","leave-absences/shared/modules/shared-settings","leave-absences/shared/components/leave-notification.component","leave-absences/shared/models/leave-request-model","leave-absences/waiting-approval-notification/components/waiting-approval-notification.component","leave-absences/waiting-approval-notification/modules/config"],function(e){return e.module("waiting-approval-notification",["ngResource","leave-absences.components","leave-absences.models","leave-absences.settings","waiting-approval-notification.components","waiting-approval-notification.config"]).run(["$log",function(e){e.debug("app.run")}]),e}),function(e,n){var t=e.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences";n.config({urlArgs:"bust="+(new Date).getTime(),paths:{"leave-absences/shared":t+"/shared","leave-absences/waiting-approval-notification":t+"/waiting-approval-notification"}}),n(["leave-absences/shared/config"],function(){n(["leave-absences/waiting-approval-notification/app"],function(e){e.bootstrap(document.querySelector("[data-leave-absences-waiting-approval-notification]"),["waiting-approval-notification"])})})}(CRM,require),define("waiting-approval-notification",function(){});