!function(e){define("leave-absences/shared/config",[],function(){var n=CRM.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences/shared";e.config({paths:{"leave-absences/shared/ui-router":"leave-absences/shared/vendor/angular-ui-router.min",mocks:"../test/mocks"},shim:{"leave-absences/shared/ui-router":{}}}),e.config({paths:{"leave-absences/shared/ui-router":n+"/vendor/angular-ui-router.min",mocks:CRM.vars.leaveAndAbsences.baseURL+"/js/angular/test/mocks"}})})}(require),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(n){return n.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","common/modules/models","common/services/check-permissions","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models","common.models.instances","common.services","leave-absences.settings"])}),define("mocks/module",["common/angularMocks","common/mocks/module"],function(e){"use strict";return angular.module("leave-absences.mocks",["common.mocks"])}),define("mocks/data/absence-type-data",["common/lodash"],function(e){var n={is_error:0,version:3,count:3,values:[{id:"1",title:"Holiday / Vacation",weight:"1",color:"#151D2C",is_default:"1",is_reserved:"1",allow_request_cancelation:"3",allow_overuse:"0",must_take_public_holiday_as_leave:"1",default_entitlement:"20",add_public_holiday_to_entitlement:"1",is_active:"1",allow_accruals_request:"0",allow_accrue_in_the_past:"0",allow_carry_forward:"1",max_number_of_days_to_carry_forward:"5",carry_forward_expiration_duration:"12",carry_forward_expiration_unit:"2"},{id:"2",title:"TOIL",weight:"2",color:"#056780",is_default:"0",is_reserved:"1",allow_request_cancelation:"3",allow_overuse:"0",must_take_public_holiday_as_leave:"0",default_entitlement:"0",add_public_holiday_to_entitlement:"0",is_active:"1",allow_accruals_request:"1",max_leave_accrual:"5",allow_accrue_in_the_past:"0",accrual_expiration_duration:"3",accrual_expiration_unit:"2",allow_carry_forward:"0"},{id:"3",title:"Sick",weight:"3",color:"#B32E2E",is_default:"0",is_reserved:"1",allow_request_cancelation:"1",allow_overuse:"1",must_take_public_holiday_as_leave:"0",default_entitlement:"0",add_public_holiday_to_entitlement:"0",is_active:"1",allow_accruals_request:"0",allow_accrue_in_the_past:"0",allow_carry_forward:"0"},{id:"4",title:"Weekend",weight:"4",color:"#B32E2E",is_default:"0",is_reserved:"1",allow_request_cancelation:"1",allow_overuse:"1",must_take_public_holiday_as_leave:"0",default_entitlement:"0",add_public_holiday_to_entitlement:"0",is_active:"1",allow_accruals_request:"0",allow_accrue_in_the_past:"0",allow_carry_forward:"0"},{id:"5",title:"Custom",weight:"5",color:"null",is_default:"0",is_reserved:"0",allow_request_cancelation:"3",must_take_public_holiday_as_leave:"0",default_entitlement:"10",add_public_holiday_to_entitlement:"0",is_active:"0",allow_accruals_request:"0",allow_carry_forward:"0",is_sick:"0"}]},t={values:{expiry_date:"2016-07-08"}};return{all:function(){return n},getRandomAbsenceType:function(t){return e.sample(n.values)[t]},getAllAbsenceTypesByKey:function(e){return n.values.map(function(n){return n[e]})},getAllAbsenceTypesTitles:function(){return this.getAllAbsenceTypesByKey("title")},getAllAbsenceTypesIds:function(){return this.getAllAbsenceTypesByKey("id")},calculateToilExpiryDate:function(){return t},getDisabledAbsenceTypes:function(){return n.values.filter(function(e){return"0"===e.is_active})},findByKeyValue:function(t,a){return e.find(n.values,function(e){return e[t]===a})}}}),define("mocks/data/leave-balance-report.data",["common/mocks/data/contact.data","mocks/data/absence-type-data"],function(e,n){function t(){return e.all.values.map(function(e){return{id:e.id,contact_id:e.contact_id,contact_display_name:e.display_name,absence_types:n.all().values.map(function(e){return{id:e.id,entitlement:4,used:3,balance:1,requested:1}})}})}var a=t();return{all:function(){return{is_error:0,version:123,count:a.length,values:a}}}}),define("mocks/apis/leave-balance-report-api-mock",["mocks/module","mocks/data/leave-balance-report.data"],function(e,n){"use strict";e.factory("LeaveBalanceReportAPIMock",["$q",function(e){return{getAll:function(t,a,s){var i=n.all().values;return e.resolve({list:i,total:i.length,allIds:i.map(function(e){return e.id}).join(",")})}}}])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings","mocks/apis/leave-balance-report-api-mock"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.models.instances","leave-absences.settings","leave-absences.mocks"])}),define("leave-absences/shared/apis/leave-request-api",["leave-absences/shared/modules/apis","common/lodash","common/services/api"],function(e,n){"use strict";e.factory("LeaveRequestAPI",["$log","api","$q","shared-settings",function(e,t,a){return e.debug("LeaveRequestAPI"),t.extend({all:function(n,t,s,i,o){e.debug("LeaveRequestAPI.all");var c=a.defer();return n&&n.contact_id&&n.contact_id.IN&&0===n.contact_id.IN.length?c.resolve({list:[],total:0,allIds:[]}):c.resolve(this.getAll("LeaveRequest",n,t,s,i,"getFull",o)),c.promise},balanceChangeByAbsenceType:function(n,t,s,i){e.debug("LeaveRequestAPI.balanceChangeByAbsenceType");var o=a.defer();n&&t||o.reject("contact_id and period_id are mandatory");var c={contact_id:n,period_id:t,statuses:s?{IN:s}:null,public_holiday:i||!1};return this.sendGET("LeaveRequest","getbalancechangebyabsencetype",c,!1).then(function(e){o.resolve(e.values)}),o.promise},calculateBalanceChange:function(n){e.debug("LeaveRequestAPI.calculateBalanceChange",n);var t=a.defer();return!n||n.contact_id&&n.from_date&&n.from_date_type||t.reject("contact_id, from_date and from_date_type in params are mandatory"),this.sendPOST("LeaveRequest","calculatebalancechange",n).then(function(e){t.resolve(e.values)}),t.promise},create:function(n){e.debug("LeaveRequestAPI.create",n);var t=a.defer();return n&&(n.to_date&&!n.to_date_type?t.reject("to_date_type is mandatory"):n.contact_id&&n.from_date&&n.from_date_type&&n.status_id||t.reject("contact_id, from_date, status_id and from_date_type params are mandatory")),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise},delete:function(e){return this.sendPOST("LeaveRequest","delete",{id:e})},deleteAttachment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,attachment_id:t}),this.sendPOST("LeaveRequest","deleteattachment",a).then(function(e){return e.values})},deleteComment:function(e,t){return t=n.assign({},t,{comment_id:e}),this.sendPOST("LeaveRequest","deletecomment",t).then(function(e){return e.values})},find:function(n){return e.debug("LeaveRequestAPI.find"),this.sendGET("LeaveRequest","getFull",{id:n}).then(function(e){return 0===e.values.length?a.reject("LeaveRequest not found with this ID"):e.values[0]})},getAttachments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getattachments",t,!1).then(function(e){return e.values})},getComments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getcomment",t,!1).then(function(e){return e.values})},isManagedBy:function(n,t){return e.debug("LeaveRequestAPI.isManagedBy"),this.sendPOST("LeaveRequest","isManagedBy",{leave_request_id:n,contact_id:t}).then(function(e){return e.values})},isValid:function(t){e.debug("LeaveRequestAPI.isValid",t);var s=a.defer();return this.sendPOST("LeaveRequest","isValid",t).then(function(e){e.count>0?s.reject(n(e.values).map().flatten().value()):s.resolve(e.values)}),s.promise},saveComment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,text:t.text,contact_id:t.contact_id}),this.sendPOST("LeaveRequest","addcomment",a).then(function(e){return e.values})},update:function(n){e.debug("LeaveRequestAPI.update",n);var t=a.defer();return n.id||t.reject("id is mandatory field"),this.sendPOST("LeaveRequest","create",n).then(function(e){return e.values[0]})}})}])}),define("leave-absences/shared/instances/leave-request.instance",["common/lodash","leave-absences/shared/modules/models-instances","common/models/option-group","common/models/instances/instance"],function(e,n){"use strict";n.factory("LeaveRequestInstance",["$q","checkPermissions","OptionGroup","shared-settings","ModelInstance","LeaveRequestAPI",function(n,t,a,s,i,o){function c(e){return u(e).then(function(e){var t=this.status_id;return this.status_id=e.value,this.update().catch(function(e){return this.status_id=t,n.reject(e)}.bind(this))}.bind(this))}function r(e){return u(e).then(function(e){return this.status_id===e.value}.bind(this))}function l(){var t=[];return e.forEach(this.files,function(e){e.toBeDeleted&&t.push(o.deleteAttachment(this.id,e.attachment_id))}.bind(this)),n.all(t)}function u(e){return a.valuesOf("hrleaveandabsences_leave_request_status").then(function(n){return n.find(function(n){return n.name===e})})}function d(){var e=this.id,t=[];return t.push(n.sequence(this.comments.filter(function(e){return!e.comment_id}).map(function(n){return function(){return o.saveComment(e,n)}}))),t=t.concat(this.comments.filter(function(e){return e.comment_id&&e.toBeDeleted}).map(function(e){return o.deleteComment(e.comment_id)})),n.all(t)}return i.extend({defaultCustomData:function(){return{comments:[],files:[],request_type:"leave"}},cancel:function(){return c.call(this,s.statusNames.cancelled)},approve:function(){return c.call(this,s.statusNames.approved)},reject:function(){return c.call(this,s.statusNames.rejected)},sendBack:function(){return c.call(this,s.statusNames.moreInformationRequired)},update:function(){return o.update(this.toAPI()).then(function(){return n.all([d.call(this),l.call(this)])}.bind(this))},create:function(){return o.create(this.toAPI()).then(function(e){return this.id=e.id,n.all([d.call(this)])}.bind(this))},deleteAttachment:function(e){e.toBeDeleted||(e.toBeDeleted=!0)},deleteComment:function(n){return n.comment_id?void(n.toBeDeleted=!0):void(this.comments=e.reject(this.comments,function(e){return n.created_at===e.created_at&&n.text===e.text}))},delete:function(){return o.delete(this.id)},isValid:function(){return o.isValid(this.toAPI())},isApproved:function(){return r.call(this,s.statusNames.approved)},isAwaitingApproval:function(){return r.call(this,s.statusNames.awaitingApproval)},isCancelled:function(){return r.call(this,s.statusNames.cancelled)},isRejected:function(){return r.call(this,s.statusNames.rejected)},isSentBack:function(){return r.call(this,s.statusNames.moreInformationRequired)},loadComments:function(){return this.id?o.getComments(this.id).then(function(e){this.comments=e}.bind(this)):n.resolve()},roleOf:function(e){return this.contact_id===e?n.resolve("owner"):t(s.permissions.admin.administer).then(function(n){return n?"admin":o.isManagedBy(this.id,e).then(function(e){return e?"manager":"none"})}.bind(this))},toAPIFilter:function(n,t,a){e.includes(["balance_change","dates","comments","files"],a)||(n[a]=this[a])},loadAttachments:function(){return this.id?o.getAttachments(this.id).then(function(e){this.files=e}.bind(this)):n.resolve()}})}])}),define("leave-absences/shared/models/leave-request-model",["leave-absences/shared/modules/models","common/models/model","leave-absences/shared/apis/leave-request-api","leave-absences/shared/instances/leave-request.instance"],function(e){"use strict";e.factory("LeaveRequest",["$log","Model","LeaveRequestAPI","LeaveRequestInstance",function(e,n,t,a){return e.debug("LeaveRequest"),n.extend({all:function(e,n,s,i,o){return t.all(this.processFilters(e),n,s,i,o).then(function(e){return e.list=e.list.map(function(e){return a.init(e,!0)}),e})},balanceChangeByAbsenceType:function(e,n,a,s){return t.balanceChangeByAbsenceType(e,n,a,s)},calculateBalanceChange:function(n){return e.debug("LeaveRequestAPI.calculateBalanceChange"),t.calculateBalanceChange(n)},find:function(e){return t.find(e).then(function(e){return a.init(e,!0)})}})}])}),define("leave-absences/shared/modules/components",["common/angular"],function(e){return e.module("leave-absences.components",[])}),define("leave-absences/shared/components/leave-notification-badge.component",["leave-absences/shared/modules/components"],function(e){function n(e,n,t){function a(){return t.all(i.filters,null,null,null,!1).then(function(e){i.count=e.list.length})}function s(){n.subscribe(i.refreshCountEventName,a)}e.debug("Component: leave-notification-badge");var i=this;i.count=0,function(){s(),a()}()}e.component("leaveNotificationBadge",{bindings:{filters:"<",refreshCountEventName:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"components/leave-notification-badge.html"}],controllerAs:"badge",controller:n}),n.$inject=["$log","pubSub","LeaveRequest"]}),function(e){define("leave-absences/manager-notification-badge/modules/settings",["common/angular"],function(n){return n.module("manager-notification-badge.settings",[]).constant("settings",{debug:e.debug,pathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-notification-badge/"})})}(CRM),function(e){define("leave-absences/manager-notification-badge/modules/config",["common/angular","leave-absences/manager-notification-badge/modules/settings"],function(e){return e.module("manager-notification-badge.config",["manager-notification-badge.settings"]).config(["$resourceProvider","$httpProvider","$logProvider","settings",function(e,n,t,a){t.debugEnabled(a.debug),e.defaults.stripTrailingSlashes=!1,n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])})}(CRM),define("leave-absences/manager-notification-badge/modules/components",["common/angular"],function(e){return e.module("manager-notification-badge.components",[])}),define("leave-absences/manager-notification-badge/components/manager-notification-badge.component",["common/lodash","leave-absences/manager-notification-badge/modules/components"],function(e,n){function t(n,t,a,s,i){function o(){return a.get().then(function(e){l.managed_by=e.contactId})}function c(){return r().then(function(n){l.status_id=e.find(n,function(e){return e.name===i.statusNames.awaitingApproval}).value})}function r(){return s.valuesOf("hrleaveandabsences_leave_request_status")}n.debug("Component: manager-notification-badge");var l={},u=this;u.refreshCountEventName="ManagerBadge:: Update Count",function(){t.all([o(),c()]).then(function(){u.filters=l})}()}n.component("managerNotificationBadge",{templateUrl:["settings",function(e){return e.pathTpl+"components/manager-notification-badge.html"}],controllerAs:"managerNotificationBadge",controller:t}),t.$inject=["$log","$q","Session","OptionGroup","shared-settings"]}),define("leave-absences/manager-notification-badge/app",["common/angular","common/models/session.model","common/services/pub-sub","leave-absences/shared/modules/shared-settings","leave-absences/shared/models/leave-request-model","leave-absences/shared/components/leave-notification-badge.component","leave-absences/manager-notification-badge/modules/config","leave-absences/manager-notification-badge/components/manager-notification-badge.component"],function(e){return e.module("manager-notification-badge",["ngResource","leave-absences.settings","leave-absences.models","leave-absences.components","manager-notification-badge.components","manager-notification-badge.config"]).run(["$log",function(e){e.debug("app.run")}]),e}),function(e,n){var t=e.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences";n.config({urlArgs:"bust="+(new Date).getTime(),paths:{"leave-absences/shared":t+"/shared","leave-absences/manager-notification-badge":t+"/manager-notification-badge"}}),n(["leave-absences/shared/config"],function(){n(["leave-absences/manager-notification-badge/app"],function(e){e.bootstrap(document.querySelector("[data-leave-absences-manager-notification-badge]"),["manager-notification-badge"])})})}(CRM,require),define("manager-notification-badge",function(){});