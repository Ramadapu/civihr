!function(e){define("leave-absences/shared/config",[],function(){var n=CRM.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences/shared";e.config({paths:{"leave-absences/shared/ui-router":"leave-absences/shared/vendor/angular-ui-router.min"},shim:{"leave-absences/shared/ui-router":{}}}),e.config({paths:{"leave-absences/shared/ui-router":n+"/vendor/angular-ui-router.min"}})})}(require),function(e){define("leave-absences/absence-tab/modules/settings",["common/angular"],function(n){return n.module("absence-tab.settings",[]).constant("settings",{contactId:e.vars.leaveAndAbsences.contactId,debug:e.debug,pathTpl:e.vars.leaveAndAbsences.baseURL+"/views/absence-tab/"})})}(CRM),function(e){define("leave-absences/absence-tab/modules/config",["common/angular","leave-absences/absence-tab/modules/settings"],function(e){return e.module("absence-tab.config",["absence-tab.settings"]).config(["$resourceProvider","$httpProvider","$logProvider","settings",function(e,n,t,s){t.debugEnabled(s.debug),e.defaults.stripTrailingSlashes=!1,n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])})}(CRM),define("leave-absences/absence-tab/modules/components",["common/angular"],function(e){return e.module("absence-tab.components",[])}),define("leave-absences/absence-tab/components/absence-tab-container",["leave-absences/absence-tab/modules/components"],function(e){e.component("absenceTabContainer",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-container.html"}],controllerAs:"absence",controller:["$log","$rootScope",function(e,n){e.debug("Component: absence-tab-container"),n.role="admin";var t={};return t}]})}),define("leave-absences/absence-tab/components/absence-tab-report",["leave-absences/absence-tab/modules/components"],function(e){function n(e){e.debug("Component: absence-tab-report");var n={};return n}e.component("absenceTabReport",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-report.html"}],controllerAs:"report",controller:["$log",n]})}),define("leave-absences/absence-tab/components/absence-tab-entitlements",["leave-absences/absence-tab/modules/components"],function(e){function n(e){e.debug("Component: absence-tab-entitlements");var n={};return n}e.component("absenceTabEntitlements",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-entitlements.html"}],controllerAs:"entitlements",controller:["$log",n]})}),define("leave-absences/absence-tab/components/absence-tab-work-patterns",["leave-absences/absence-tab/modules/components"],function(e){function n(e){e.debug("Component: absence-tab-work-patterns");var n={};return n}e.component("absenceTabWorkPatterns",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-work-patterns.html"}],controllerAs:"workpatterns",controller:["$log",n]})}),define("leave-absences/shared/modules/components",["common/angular"],function(e){return e.module("leave-absences.components",[])}),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(n){return n.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10,allowedMimeTypes:{txt:"plain",png:"png",jpeg:"jpeg",bmp:"bmp",gif:"gif",pdf:"pdf",doc:"msword",docx:"vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"vnd.ms-excel",xlsx:"vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"vnd.ms-powerpoint",pptx:"vnd.openxmlformats-officedocument.presentationml.presentation"}},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models.instances","common.services","leave-absences.settings"])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/modules/controllers",["common/angular","common/angularBootstrap","leave-absences/shared/modules/models","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){return e.module("leave-absences.controllers",["ui.select","leave-absences.models","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/models/instances/absence-period-instance",["leave-absences/shared/modules/models-instances","common/moment","common/models/instances/instance","common/services/hr-settings"],function(e,n){"use strict";e.factory("AbsencePeriodInstance",["$log","ModelInstance","HR_settings",function(e,t,s){return e.debug("AbsencePeriodInstance"),t.extend({defaultCustomData:function(){return{current:!1}},transformAttributes:function(e){var t=n();return e.current=!1,n(e.start_date).isSameOrBefore(t,"day")&&n(e.end_date).isSameOrAfter(t,"day")&&(e.current=!0),e},isInPeriod:function(e){var t=s.DATE_FORMAT.toUpperCase(),a=n(e,t);return n(this.start_date).isSameOrBefore(a)&&n(this.end_date).isSameOrAfter(a)}})}])}),define("leave-absences/shared/apis/absence-period-api",["leave-absences/shared/modules/apis","common/services/api"],function(e){"use strict";e.factory("AbsencePeriodAPI",["$log","api",function(e,n){return e.debug("AbsencePeriodAPI"),n.extend({all:function(n){return e.debug("AbsencePeriodAPI"),this.sendGET("AbsencePeriod","get",n).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/absence-period-model",["leave-absences/shared/modules/models","common/moment","leave-absences/shared/modules/shared-settings","leave-absences/shared/models/instances/absence-period-instance","leave-absences/shared/apis/absence-period-api","common/models/model","common/services/hr-settings"],function(e,n){"use strict";e.factory("AbsencePeriod",["$log","Model","AbsencePeriodAPI","AbsencePeriodInstance","shared-settings",function(e,t,s,a,o){return e.debug("AbsencePeriod"),t.extend({all:function(e){return s.all(e).then(function(e){return e.map(function(e){return a.init(e,!0)})})},current:function(){var e=n().format(o.serverDateFormat),t={start_date:{"<=":e},end_date:{">=":e}};return s.all(t).then(function(e){return e&&e.length?a.init(e[0],!0):null})}})}])}),define("leave-absences/shared/models/instances/absence-type-instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("AbsenceTypeInstance",["$log","ModelInstance",function(e,n){return e.debug("AbsenceTypeInstance"),n.extend({})}])}),define("leave-absences/shared/apis/absence-type-api",["common/lodash","common/moment","leave-absences/shared/modules/apis","common/services/api"],function(e,n,t){"use strict";t.factory("AbsenceTypeAPI",["$log","api","shared-settings",function(t,s,a){return t.debug("AbsenceTypeAPI"),s.extend({all:function(n){return t.debug("AbsenceTypeAPI.all"),this.sendGET("AbsenceType","get",e.defaults(n||{},{is_active:!0})).then(function(e){return e.values})},calculateToilExpiryDate:function(s,o,r){return t.debug("AbsenceTypeAPI.calculateToilExpiryDate"),r=e.assign({},r,{absence_type_id:s,date:n(o).format(a.serverDateFormat)}),this.sendPOST("AbsenceType","calculateToilExpiryDate",r).then(function(e){return e.values.expiry_date})}})}])}),define("leave-absences/shared/models/absence-type-model",["leave-absences/shared/modules/models","leave-absences/shared/models/instances/absence-type-instance","leave-absences/shared/apis/absence-type-api","common/models/model"],function(e){"use strict";e.factory("AbsenceType",["$log","Model","AbsenceTypeAPI","AbsenceTypeInstance",function(e,n,t,s){return e.debug("AbsenceType"),n.extend({all:function(e){return t.all(e).then(function(e){return e.map(function(e){return s.init(e,!0)})})},calculateToilExpiryDate:function(e,n,s){return t.calculateToilExpiryDate(e,n,s)}})}])}),define("leave-absences/shared/models/instances/public-holiday-instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("PublicHolidayInstance",["$log","ModelInstance",function(e,n){return e.debug("PublicHolidayInstance"),n.extend({})}])}),define("leave-absences/shared/apis/public-holiday-api",["leave-absences/shared/modules/apis","common/services/api"],function(e){"use strict";e.factory("PublicHolidayAPI",["$log","api",function(e,n){return e.debug("PublicHolidayAPI"),n.extend({all:function(n){return e.debug("PublicHolidayAPI"),this.sendGET("PublicHoliday","get",n).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/public-holiday-model",["leave-absences/shared/modules/models","common/moment","leave-absences/shared/models/instances/public-holiday-instance","leave-absences/shared/apis/public-holiday-api","common/models/model","common/services/hr-settings"],function(e,n){"use strict";e.factory("PublicHoliday",["$log","Model","PublicHolidayAPI","PublicHolidayInstance","shared-settings",function(e,t,s,a,o){return e.debug("PublicHoliday"),t.extend({all:function(n){return e.debug("PublicHoliday.all",n),s.all(n).then(function(e){return e.map(function(e){return a.init(e,!0)})})},isPublicHoliday:function(t){e.debug("PublicHoliday.isPublicHoliday",t);var a=n(t).format(o.serverDateFormat),r={date:a};return s.all(r).then(function(e){return!!e.length})}})}])}),define("leave-absences/shared/controllers/calendar-ctrl",["leave-absences/shared/modules/controllers","common/lodash","common/moment","leave-absences/shared/models/absence-period-model","leave-absences/shared/models/absence-type-model","leave-absences/shared/models/public-holiday-model"],function(e,n,t){"use strict";function s(e,s,a,o,r,i,c,l){function d(e){var t=n.find(m,function(n){return n.name===e});return!!t&&t.value}var u=[],m=[],h=[];return this.absencePeriods=[],this.absenceTypes=[],this.leaveRequests={},this.months=[],this.monthLabels=t.monthsShort(),this.selectedMonths=[],this.selectedPeriod=null,this.loading={calendar:!1,page:!1},this.changeSelectedPeriod=function(){this._fetchMonthsFromPeriod(),this.refresh()},this.getAbsenceTypeStyle=function(e){return{backgroundColor:e.color,borderColor:e.color}},this.getDayName=function(e){return this._getDateObjectWithFormat(e).format("ddd")},this.isPublicHoliday=function(e){return!!h[this._getDateObjectWithFormat(e).valueOf()]},this.labelPeriod=function(e){return e.current?"Current Period ("+e.title+")":e.title},this._fetchMonthsFromPeriod=function(){for(var e=[],n=t(this.selectedPeriod.start_date),s=t(this.selectedPeriod.end_date);n.isBefore(s);)e.push(this._getMonthSkeleton(n)),n.add(1,"month");this.months=e},this._getDateObjectWithFormat=function(e){return t(e,a.serverDateFormat)},this._getMonthObjectByDate=function(e,t){return n.find(t,function(n){return n.month===e.month()&&n.year===e.year()})},this._getStyles=function(e,t){var s;return t.leaveRequest=e,s=n.find(this.absenceTypes,function(n){return n.id===e.type_id}),e.balance_change>0?(t.UI.isAccruedTOIL=!0,{borderColor:s.color}):{backgroundColor:s.color,borderColor:s.color}},this._init=function(n){this.loading.page=!0,this.selectedMonths=[this.monthLabels[t().month()]],e.all([this._loadAbsencePeriods(),this._loadAbsenceTypes(),this._loadPublicHolidays(),this._loadStatuses(),this._loadDayTypes()]).then(function(){return n?n():null}).then(function(){return this.legendCollapsed=!1,this._loadLeaveRequestsAndCalendar()}.bind(this)).finally(function(){this.loading.page=!1}.bind(this))},this._isDayType=function(e,n,s){var a=u[e];return t(s).isSame(n.from_date)?a.value===n.from_date_type:t(s).isSame(n.to_date)?a.value===n.to_date_type:void 0},this._isPendingApproval=function(e){var n=m[e.status_id];return n.name===a.statusNames.awaitingApproval},this._loadAbsencePeriods=function(){return o.all().then(function(e){this.absencePeriods=n.sortBy(e,"start_date"),this.selectedPeriod=n.find(this.absencePeriods,function(e){return!!e.current}),this._fetchMonthsFromPeriod()}.bind(this))},this._loadAbsenceTypes=function(){return r.all({is_active:!0}).then(function(e){this.absenceTypes=e}.bind(this))},this._loadDayTypes=function(){return l.valuesOf("hrleaveandabsences_leave_request_day_type").then(function(e){u=n.indexBy(e,"name")})},this._loadLeaveRequestsAndCalendar=function(e,n,t){n=void 0===n||n;var s={from_date:{from:this.selectedPeriod.start_date},to_date:{to:this.selectedPeriod.end_date},status_id:{IN:[d(a.statusNames.approved),d(a.statusNames.adminApproved),d(a.statusNames.awaitingApproval)]}};return s[e]=this.contactId,i.all(s,{},null,null,n).then(function(e){return this._indexLeaveRequests(e.list),this._loadCalendar()}.bind(this)).then(function(){t&&t(),this.loading.calendar=!1,this._showMonthLoader()}.bind(this))},this._loadPublicHolidays=function(){return c.all().then(function(e){h=n.transform(e,function(e,n){e[this._getDateObjectWithFormat(n.date).valueOf()]=n}.bind(this),{})}.bind(this))},this._loadStatuses=function(){return l.valuesOf("hrleaveandabsences_leave_request_status").then(function(e){m=n.indexBy(e,"value")})},this._resetMonths=function(){n.each(this.months,function(e){e.data=[]})},this._showMonthLoader=function(){var e=500,n=0;this.months.forEach(function(t){t.loading=t.label!==this.selectedMonths[0],t.loading&&(s(function(){t.loading=!1},n),n+=e)}.bind(this))},this}e.controller("CalendarCtrl",["$q","$timeout","shared-settings","AbsencePeriod","AbsenceType","LeaveRequest","PublicHoliday","OptionGroup",s])}),define("leave-absences/shared/components/staff-leave-calendar",["common/lodash","common/moment","leave-absences/shared/modules/components","leave-absences/shared/controllers/calendar-ctrl"],function(e,n,t){function s(t,s,a,o){s.debug("Component: staff-leave-calendar");var r=t("CalendarCtrl"),i=Object.create(r);return i.getMonthData=function(n){var t;return t=e.find(i.months,function(e){return e.month===n.month&&e.year===n.year}),t?t.data:[]},i.refresh=function(){i.loading.calendar=!0,i._resetMonths(),i._loadLeaveRequestsAndCalendar()},i._getMonthSkeleton=function(e){return{month:e.month(),year:e.year(),data:[]}},i._indexLeaveRequests=function(n){i.leaveRequests={},e.each(n,function(n){e.each(n.dates,function(e){i.leaveRequests[e.date]=n})})},i._loadCalendar=function(){return o.get(i.contactId,i.selectedPeriod.id).then(function(e){i._setCalendarProps(e)})},i._loadLeaveRequestsAndCalendar=function(){return r._loadLeaveRequestsAndCalendar.call(i,"contact_id",!1)},i._setCalendarProps=function(t){var s,a=e.clone(i.months);e.each(t.days,function(e){s=i.leaveRequests[e.date],e.UI={isWeekend:t.isWeekend(i._getDateObjectWithFormat(e.date)),isNonWorkingDay:t.isNonWorkingDay(i._getDateObjectWithFormat(e.date)),isPublicHoliday:i.isPublicHoliday(e.date)},s&&(e.UI.styles=i._getStyles(s,e),e.UI.isRequested=i._isPendingApproval(s),e.UI.isAM=i._isDayType("half_day_am",s,e.date),e.UI.isPM=i._isDayType("half_day_pm",s,e.date)),i._getMonthObjectByDate(n(e.date),a).data.push(e)}),i.months=a},function(){i._init(),a.$on("LeaveRequest::new",i.refresh),a.$on("LeaveRequest::edit",i.refresh)}(),i}t.component("staffLeaveCalendar",{bindings:{contactId:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"components/staff-leave-calendar.html"}],controllerAs:"calendar",controller:["$controller","$log","$rootScope","Calendar",s]})}),define("leave-absences/shared/models/instances/calendar-instance",["common/lodash","common/moment","leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e,n,t){"use strict";t.factory("CalendarInstance",["$log","ModelInstance","shared-settings",function(t,s,a){function o(e,n){var t=this.days[r(e).valueOf()];return!!t&&t.type.name===n}function r(e){return n(e,a.serverDateFormat).clone()}return s.extend({transformAttributes:function(n){var t={};return n.calendar.forEach(function(e){t[r(e.date).valueOf()]=e}),e(n).omit("calendar").assign({days:t}).value()},defaultCustomData:function(){return{days:[]}},isWorkingDay:function(e){return o.call(this,e,"working_day")},isNonWorkingDay:function(e){return o.call(this,e,"non_working_day")},isWeekend:function(e){return o.call(this,e,"weekend")}})}])}),define("leave-absences/shared/apis/work-pattern-api",["common/lodash","leave-absences/shared/modules/apis","common/services/api"],function(e,n){"use strict";n.factory("WorkPatternAPI",["$log","api",function(n,t){return n.debug("WorkPatternAPI"),t.extend({getCalendar:function(t,s,a){return n.debug("WorkPatternAPI.getCalendar",t,s,a),this.sendGET("WorkPattern","getcalendar",e.assign({},a,{contact_id:e.isArray(t)?{IN:t}:t,period_id:s}))}})}])}),define("leave-absences/shared/models/calendar-model",["common/lodash","leave-absences/shared/modules/models","leave-absences/shared/models/instances/calendar-instance","leave-absences/shared/apis/work-pattern-api","common/models/model"],function(e,n){"use strict";n.factory("Calendar",["$log","Model","WorkPatternAPI","CalendarInstance",function(n,t,s,a){return n.debug("Calendar"),t.extend({get:function(t,o,r){return n.debug("Calendar.get"),s.getCalendar(t,o,r).then(function(n){var s=n.values.map(function(e){return a.init(e)});return e.isArray(t)?s:s[0]})}})}])}),define("leave-absences/shared/models/instances/leave-request-instance",["common/lodash","leave-absences/shared/modules/models-instances","common/models/option-group","common/models/instances/instance","common/services/file-upload"],function(e,n){"use strict";n.factory("LeaveRequestInstance",["$q","OptionGroup","FileUpload","shared-settings","ModelInstance","LeaveRequestAPI",function(n,t,s,a,o,r){function i(e){return d(e).then(function(e){return this.status_id=e.value,this.update()}.bind(this))}function c(e){return d(e).then(function(e){return this.status_id===e.value}.bind(this))}function l(){var t=[];return e.forEach(this.files,function(e){e.toBeDeleted&&t.push(r.deleteAttachment(this.id,e.attachment_id))}.bind(this)),n.all(t)}function d(e){return t.valuesOf("hrleaveandabsences_leave_request_status").then(function(n){return n.find(function(n){return n.name===e})})}function u(){var e=[],t=this;return t.comments.map(function(n,s){n.comment_id?n.toBeDeleted&&e.push(r.deleteComment(n.comment_id)):!function(s){e.push(r.saveComment(t.id,n).then(function(e){t.comments[s]=e}))}(s)}),n.all(e)}function m(){return this.fileUploader.queue&&this.fileUploader.queue.length>0?this.fileUploader.uploadAll({entityID:this.id}):n.resolve([])}return o.extend({defaultCustomData:function(){return{comments:[],files:[],request_type:"leave",fileUploader:s.uploader({entityTable:"civicrm_hrleaveandabsences_leave_request",crmAttachmentToken:a.attachmentToken,queueLimit:a.fileUploader.queueLimit,allowedMimeTypes:a.fileUploader.allowedMimeTypes})}},cancel:function(){return i.call(this,a.statusNames.cancelled)},approve:function(){return i.call(this,a.statusNames.approved)},reject:function(){return i.call(this,a.statusNames.rejected)},sendBack:function(){return i.call(this,a.statusNames.moreInformationRequired)},update:function(){return r.update(this.toAPI()).then(function(){return n.all([u.call(this),m.call(this),l.call(this)])}.bind(this))},create:function(){return r.create(this.toAPI()).then(function(e){return this.id=e.id,n.all([u.call(this),m.call(this)])}.bind(this))},deleteAttachment:function(e){e.toBeDeleted||(e.toBeDeleted=!0)},deleteComment:function(n){return n.comment_id?void(n.toBeDeleted=!0):void(this.comments=e.reject(this.comments,function(e){return n.created_at===e.created_at&&n.text===e.text}))},delete:function(){return this.is_deleted=!0,r.update(this.toAPI())},isValid:function(){return r.isValid(this.toAPI())},isApproved:function(){return c.call(this,a.statusNames.approved)},isAwaitingApproval:function(){return c.call(this,a.statusNames.awaitingApproval)},isCancelled:function(){return c.call(this,a.statusNames.cancelled)},isRejected:function(){return c.call(this,a.statusNames.rejected)},isSentBack:function(){return c.call(this,a.statusNames.moreInformationRequired)},loadComments:function(){return this.id?r.getComments(this.id).then(function(e){this.comments=e}.bind(this)):n.resolve()},toAPIFilter:function(n,t,s){e.includes(["balance_change","dates","comments","fileUploader","files"],s)||(n[s]=this[s])},loadAttachments:function(){return this.id?r.getAttachments(this.id).then(function(e){this.files=e}.bind(this)):n.resolve()}})}])}),define("leave-absences/shared/apis/leave-request-api",["leave-absences/shared/modules/apis","common/lodash","common/services/api"],function(e,n){"use strict";e.factory("LeaveRequestAPI",["$log","api","$q","shared-settings",function(e,t,s){return e.debug("LeaveRequestAPI"),t.extend({all:function(n,t,a,o,r){e.debug("LeaveRequestAPI.all");var i=s.defer();return n&&n.contact_id&&n.contact_id.IN&&0===n.contact_id.IN.length?i.resolve({list:[],total:0,allIds:[]}):i.resolve(this.getAll("LeaveRequest",n,t,a,o,"getFull",r)),i.promise},balanceChangeByAbsenceType:function(n,t,a,o){e.debug("LeaveRequestAPI.balanceChangeByAbsenceType");var r=s.defer();n&&t||r.reject("contact_id and period_id are mandatory");var i={contact_id:n,period_id:t,statuses:a?{IN:a}:null,public_holiday:o||!1};return this.sendGET("LeaveRequest","getbalancechangebyabsencetype",i,!1).then(function(e){r.resolve(e.values)}),r.promise},update:function(n){e.debug("LeaveRequestAPI.update",n);var t=s.defer();return n.id||t.reject("id is mandatory field"),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise},calculateBalanceChange:function(n){e.debug("LeaveRequestAPI.calculateBalanceChange",n);var t=s.defer();return!n||n.contact_id&&n.from_date&&n.from_date_type||t.reject("contact_id, from_date and from_date_type in params are mandatory"),this.sendPOST("LeaveRequest","calculatebalancechange",n).then(function(e){t.resolve(e.values)}),t.promise},create:function(n){e.debug("LeaveRequestAPI.create",n);var t=s.defer();return n&&(n.to_date&&!n.to_date_type?t.reject("to_date_type is mandatory"):n.contact_id&&n.from_date&&n.from_date_type&&n.status_id||t.reject("contact_id, from_date, status_id and from_date_type params are mandatory")),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise},isValid:function(t){e.debug("LeaveRequestAPI.isValid",t);var a=s.defer();return this.sendPOST("LeaveRequest","isValid",t).then(function(e){e.count>0?a.reject(n(e.values).map().flatten().value()):a.resolve(e.values)}),a.promise},getComments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getcomment",t,!1).then(function(e){return e.values})},saveComment:function(e,t,s){return s=n.assign({},s,{leave_request_id:e,text:t.text,contact_id:t.contact_id,created_at:t.created_at}),this.sendPOST("LeaveRequest","addcomment",s).then(function(e){return e.values})},deleteComment:function(e,t){return t=n.assign({},t,{comment_id:e}),this.sendPOST("LeaveRequest","deletecomment",t).then(function(e){return e.values})},getAttachments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getattachments",t,!1).then(function(e){return e.values})},deleteAttachment:function(e,t,s){return s=n.assign({},s,{leave_request_id:e,attachment_id:t}),this.sendPOST("LeaveRequest","deleteattachment",s).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/leave-request-model",["leave-absences/shared/modules/models","leave-absences/shared/models/instances/leave-request-instance","leave-absences/shared/apis/leave-request-api","common/models/model"],function(e){"use strict";e.factory("LeaveRequest",["$log","Model","LeaveRequestAPI","LeaveRequestInstance",function(e,n,t,s){return e.debug("LeaveRequest"),n.extend({all:function(e,n,a,o,r){return t.all(this.processFilters(e),n,a,o,r).then(function(e){return e.list=e.list.map(function(e){return s.init(e,!0)}),e})},balanceChangeByAbsenceType:function(e,n,s,a){return t.balanceChangeByAbsenceType(e,n,s,a)},calculateBalanceChange:function(n){return e.debug("LeaveRequestAPI.calculateBalanceChange"),t.calculateBalanceChange(n)}})}])}),define("leave-absences/absence-tab/app",["common/angular","common/angularBootstrap","common/modules/directives","leave-absences/absence-tab/modules/config","leave-absences/absence-tab/components/absence-tab-container","leave-absences/absence-tab/components/absence-tab-report","leave-absences/absence-tab/components/absence-tab-entitlements","leave-absences/absence-tab/components/absence-tab-work-patterns","leave-absences/shared/components/staff-leave-calendar","leave-absences/shared/models/calendar-model","leave-absences/shared/models/leave-request-model","leave-absences/shared/modules/shared-settings"],function(e){return e.module("absence-tab",["ngResource","ui.bootstrap","common.directives","absence-tab.config","absence-tab.components","leave-absences.components","leave-absences.controllers","leave-absences.models","leave-absences.settings"]).run(["$log","$rootScope","shared-settings","settings",function(e,n,t,s){e.debug("app.run"),n.sharedPathTpl=t.sharedPathTpl,n.settings=s}]),e}),function(e,n){var t=e.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences";n.config({urlArgs:"bust="+(new Date).getTime(),paths:{"leave-absences/shared":t+"/shared","leave-absences/absence-tab":t+"/absence-tab"}}),n(["leave-absences/shared/config"],function(){n(["leave-absences/absence-tab/app"],function(){document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("absenceTabReady"):function(){var e=document.createEvent("Event");return e.initEvent("absenceTabReady",!0,!0),e}())})})}(CRM,require),define("absence-tab",function(){});