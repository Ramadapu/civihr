<section>
  <crm-loading show="!calendar.loading.page">
    <crm-loading show="!calendar.loading.calendar">
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-sm-5">
              <ui-select multiple
                         limit="4"
                         ng-model="calendar.selectedMonths">
                <ui-select-match placeholder="Select Months">
                  <span ng-bind="$item"></span>
                </ui-select-match>
                <ui-select-choices repeat="month in (calendar.months | filter: $select.search)">
                  <span ng-bind="month"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <div class="col-sm-offset-4 col-sm-3">
              <div class="chr_custom-select chr_custom-select--full">
                <select
                  ng-options="period as calendar.labelPeriod(period) for period in calendar.absencePeriods track by period.id"
                  ng-model="calendar.selectedPeriod"
                  ng-change="calendar.refresh()">
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <section class="panel panel-default"
               ng-repeat="month in (calendar.selectedMonths.length > 0 ? calendar.selectedMonths : calendar.months)">
        <header class="panel-heading">
          <h2 class="panel-title">{{month}}</h2>
        </header>
        <div class="table-responsive">
          <table class="table table-bordered chr_leave-calendar">
            <thead>
            <tr class="chr_leave-calendar__days">
              <th ng-repeat="day in calendar.getMonthData(calendar.months.indexOf(month))">
                {{calendar.getDayName(day.date)}}
                <div>{{$index + 1}}</div>
              </th>
            </tr>
            </thead>
            <tbody>
            <tr class="chr_leave-calendar__items">
              <td ng-repeat="day in calendar.getMonthData(calendar.months.indexOf(month))">
                <div class="chr_leave-calendar__item"
                     ng-style="day.UI.styles"
                     ng-class="{
                     'chr_leave-calendar__item--type--weekend': day.UI.isWeekend,
                     'chr_leave-calendar__item--type--non-working': day.UI.isNonWorkingDay,
                     'chr_leave-calendar__item--type--public-holiday': day.UI.isPublicHoliday,
                     'chr_leave-calendar__item--requested': day.UI.isRequested,
                     'chr_leave-calendar__item--alt': day.UI.isAccruedTOIL,
                     'chr_leave-calendar__item--toil-requested': day.UI.isRequested && day.UI.isAccruedTOIL
                     }">
                  <span ng-if="day.UI.isAM">AM</span>
                  <span ng-if="day.UI.isPM">PM</span>
                  <span ng-if="day.UI.isAccruedTOIL">AT</span>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </section>
    </crm-loading>
    <section class="panel panel-default" ng-class="{ 'is-collapsed': calendar.legendCollapsed }">
      <header class="panel-heading panel-heading-plain">
        <h2 class="panel-title" role="button" ng-click="calendar.legendCollapsed = !calendar.legendCollapsed">
          <i
            class="fa"
            aria-hidden="true"
            ng-class="{ 'fa-chevron-right': calendar.legendCollapsed, ' fa-chevron-down': !calendar.legendCollapsed }"></i>
          Legend
        </h2>
      </header>
      <div class="panel-collapse" uib-collapse="calendar.legendCollapsed">
        <div class="panel-body chr_leave-calendar__legend" ng-show="!calendar.legendCollapsed">

          <div class="row" ng-repeat-start="absenceType in calendar.absenceTypes">
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"></div>
                <span class="chr_leave-calendar__legend__label">{{absenceType.title}}</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"><span>AM</span>
                </div>
                <span class="chr_leave-calendar__legend__label">{{absenceType.title}} AM Only</span>
              </div>
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"><span>PM</span>
                </div>
                <span class="chr_leave-calendar__legend__label">{{absenceType.title}} PM Only</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--requested"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"></div>
                <span class="chr_leave-calendar__legend__label">Requested {{absenceType.title}}</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--requested"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"><span>AM</span>
                </div>
                <span class="chr_leave-calendar__legend__label">Requested {{absenceType.title}} AM</span>
              </div>
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--requested"
                     ng-style="{backgroundColor: absenceType.color, borderColor: absenceType.color}"><span>PM</span>
                </div>
                <span class="chr_leave-calendar__legend__label">Requested {{absenceType.title}} PM</span>
              </div>
            </div>
          </div>
          <div class="row" ng-repeat-end ng-if="absenceType.allow_accruals_request == 1">
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--alt"
                     ng-style="{borderColor: absenceType.color}">
                  <span>AT</span>
                </div>
                <span class="chr_leave-calendar__legend__label">Accrued TOIL</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--alt chr_leave-calendar__item--toil-requested"
                     ng-style="{borderColor: absenceType.color}">
                  <span>AT</span>
                </div>
                <span class="chr_leave-calendar__legend__label">Requested Accrued TOIL</span>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--type--weekend"></div>
                <span class="chr_leave-calendar__legend__label">Weekend</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--type--public-holiday"></div>
                <span class="chr_leave-calendar__legend__label">Public Holiday</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div class="chr_leave-calendar__item chr_leave-calendar__item--type--non-working"></div>
                <span class="chr_leave-calendar__legend__label">Non Working Day</span>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="chr_leave-calendar__legend__entry">
                <div
                  class="chr_leave-calendar__item chr_leave-calendar__item--type--late chr_leave-calendar__item--alt">
                  <span>L</span></div>
                <span class="chr_leave-calendar__legend__label">Late</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </crm-loading>
</section>
