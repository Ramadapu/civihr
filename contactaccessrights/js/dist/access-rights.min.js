define("access-rights/modules/controllers",["common/angular","common/angularBootstrap"],function(e){"use strict";return e.module("access-rights.controllers",["ui.bootstrap"])}),define("access-rights/controllers/access-rights-ctrl",["access-rights/modules/controllers"],function(e){"use strict";e.controller("AccessRightsCtrl",["$rootElement","$uibModal",function(e,t){return{openModal:function(){t.open({appendTo:e.children().eq(0),controller:"AccessRightsModalCtrl",controllerAs:"modalCtrl",bindToController:!0,templateUrl:CRM.vars.contactAccessRights.baseURL+"/views/access-rights-modal.html"})}}}])}),define("access-rights/controllers/access-rights-modal-ctrl",["common/lodash","access-rights/modules/controllers"],function(e,t){"use strict";t.controller("AccessRightsModalCtrl",["$q","$uibModalInstance","Region","Location","Right",function(t,n,r,i,s){function u(n){var r=o.originalData[n],i=o.selectedData[n],u=r.map(function(e){return e.entity_id}),a=e.difference(i,u),f=e.difference(u,i).map(function(t){return e.find(r,function(e){return e.entity_id===t}).id}),l=[];return a.length>0&&l.push(s["save"+e.capitalize(n)](a)),f.length>0&&l.push(s.deleteByIds(f)),t.all(l)}function a(){t.all([r.getAll(),i.getAll()]).then(function(e){return{regions:e[0],locations:e[1]}}).then(function(n){return t.all(e.map(n,function(t,n){return o.availableData[n]=t,s["get"+e.capitalize(n)]()}))}).then(function(e){return{regions:e[0],locations:e[1]}}).then(function(e){Object.keys(e).forEach(function(t){o.originalData[t]=e[t].values,o.selectedData[t]=e[t].values.map(function(e){return e.entity_id})})}).then(function(){o.dataLoaded=!0})}var o=this;o.availableData={regions:[],locations:[]},o.selectedData={locations:[],regions:[]},o.originalData={locations:[],regions:[]},o.errorMsg="",o.dataLoaded=!1,o.cancel=function(){n.dismiss("cancel")},o.submit=function(){t.all([u("regions"),u("locations")]).then(function(){n.dismiss("cancel")}).catch(function(e){o.errorMsg="Error while saving data"})},a()}])}),define("access-rights/modules/models",["common/angular","common/modules/apis"],function(e){"use strict";return e.module("access-rights.models",["common.apis","common.models"])}),define("access-rights/models/region",["access-rights/modules/models","common/services/api/option-group","common/models/model"],function(e){"use strict";e.factory("Region",["Model","api.optionGroup",function(e,t){return e.extend({getAll:function(){return t.valuesOf("hrjc_region")}})}])}),define("access-rights/models/location",["access-rights/modules/models","common/services/api/option-group","common/models/model"],function(e){"use strict";e.factory("Location",["Model","api.optionGroup",function(e,t){return e.extend({getAll:function(){return t.valuesOf("hrjc_location")}})}])}),define("access-rights/services/api/right",["access-rights/modules/models","common/services/api"],function(e){"use strict";e.factory("rightApi",["api","$q","$location",function(e,t,n){var r="Rights",i={contact_id:n.search().cid};return e.extend({getLocations:function(){return this.sendGET(r,"getlocations",i,!1)},getRegions:function(){return this.sendGET(r,"getregions",i,!1)},deleteByIds:function(e){return t.all(e.map(function(e){return this.sendPOST(r,"delete",{contact_id:n.search().cid,id:e})}.bind(this)))},saveRegions:function(e){return t.all(e.map(function(e){return this.sendPOST(r,"create",{contact_id:n.search().cid,entity_id:e,entity_type:"hrjc_region"})}.bind(this)))},saveLocations:function(e){return t.all(e.map(function(e){return this.sendPOST(r,"create",{contact_id:n.search().cid,entity_id:e,entity_type:"hrjc_location"})}.bind(this)))}})}])}),define("access-rights/models/right",["access-rights/modules/models","access-rights/services/api/right","common/services/api","common/models/model"],function(e){"use strict";e.factory("Right",["Model","rightApi",function(e,t){return e.extend({getLocations:t.getLocations.bind(t),getRegions:t.getRegions.bind(t),deleteByIds:t.deleteByIds.bind(t),saveRegions:t.saveRegions.bind(t),saveLocations:t.saveLocations.bind(t)})}])}),define("access-rights/app",["common/angular","common/ui-select","common/modules/xeditable-civi","common/directives/loading","access-rights/controllers/access-rights-ctrl","access-rights/controllers/access-rights-modal-ctrl","access-rights/models/region","access-rights/models/location","access-rights/models/right"],function(e){"use strict";return e.module("access-rights",["ngAnimate","ui.select","common.directives","xeditable-civi","access-rights.controllers","access-rights.models"]).run(["$log","editableOptions","editableThemes",function(e,t,n){e.debug("app.run"),t.theme="bs3"}]).config(["$locationProvider","$httpProvider",function(e,t){e.html5Mode({enabled:!0,requireBase:!1}),t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),e}),define("access-rights/dom-initialization",["common/angular"],function(e){"use strict";return{addAppToDOM:function(){var t=e.element(".crm-actions-ribbon ul#actions"),n=e.element('<li id="access-rights">           <div ng-controller="AccessRightsCtrl as $ctrl" id="bootstrap-theme">             <a href class="edit button pull-right" ng-click="$ctrl.openModal()" id="manage-roles-and-teams">               <div class="icon settings-icon"></div> Manage roles and teams             </a>           </div>         </li>');return t.append(n),n}}}),function(){"use strict";var e=CRM.vars.contactAccessRights.baseURL+"/js/src/access-rights";require.config({urlArgs:"bust="+(new Date).getTime(),paths:{"access-rights":e}}),require(["access-rights/app","access-rights/dom-initialization"],function(e,t){e.bootstrap(t.addAppToDOM(),["access-rights"])})}(require);